<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Catalogue de la Biblioth√®que</title>
    <style>
        /* --- STYLE GLOBAL --- */
        body { 
            font-family: 'Segoe UI', sans-serif; 
            max-width: 1000px; 
            margin: 0 auto; 
            padding: 20px; 
            background-color: #f3f4f6; 
            color: #374151;
        }
        
        /* --- EN-T√äTE & RECHERCHE --- */
        header { text-align: center; margin-bottom: 3rem; }
        h1 { color: #1e3a8a; margin-bottom: 0.5rem; }
        
        .search-container { 
            max-width: 600px; 
            margin: 0 auto; 
            position: relative; 
        }
        
        input[type="text"] { 
            width: 100%; 
            padding: 15px 20px; 
            font-size: 1.1rem; 
            border: 2px solid #d1d5db; 
            border-radius: 30px; 
            outline: none; 
            transition: 0.3s; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            box-sizing: border-box; /* Important pour ne pas d√©passer */
        }
        
        input[type="text"]:focus { 
            border-color: #3b82f6; 
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3); 
        }

        /* --- GRILLE DE LIVRES --- */
        .grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
            gap: 20px; 
        }
        
        /* --- CARTE LIVRE --- */
        .card { 
            background: white; 
            border-radius: 12px; 
            overflow: hidden; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); 
            transition: transform 0.2s; 
            border: 1px solid #e5e7eb; 
            display: flex; 
            flex-direction: column;
            height: 100%; /* Pour que toutes les cartes aient la m√™me hauteur visuelle */
        }
        
        .card:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); 
        }
        
        /* En-t√™te de la carte (Bleu) */
        .card-header { 
            height: 80px; 
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); 
            padding: 15px; 
            color: white; 
        }
        
        .card-title { 
            font-size: 1.2rem; 
            font-weight: bold; 
            margin: 0; 
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis; 
        }
        
        .card-author { 
            font-size: 0.9rem; 
            opacity: 0.9; 
            font-style: italic; 
        }
        
        /* Corps de la carte */
        .card-body { 
            padding: 15px; 
            flex-grow: 1; /* Pousse le footer vers le bas */
        }
        
        /* Badge de localisation (Rayon) */
        .location-badge { 
            display: inline-block; 
            background-color: #f3f4f6; 
            color: #374151; 
            padding: 5px 10px; 
            border-radius: 6px; 
            font-size: 0.8rem; 
            font-weight: 600; 
            border: 1px solid #d1d5db;
            margin-bottom: 10px;
        }

        /* --- LE R√âSUM√â (La partie importante) --- */
        .summary { 
            font-size: 0.85rem; 
            color: #6b7280; 
            line-height: 1.5;
            
            /* ICI : √áa fonctionne sans bug en CSS pur */
            display: -webkit-box;
            -webkit-line-clamp: 3;       /* Limite √† 3 lignes */
            -webkit-box-orient: vertical; /* Obligatoire */
            overflow: hidden;            /* Cache le reste */
        }

        /* Pied de page de la carte */
        .card-footer { 
            padding: 15px; 
            border-top: 1px solid #f3f4f6; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        
        .status { font-weight: bold; font-size: 0.9rem; }
        .available { color: #059669; }   /* Vert */
        .unavailable { color: #dc2626; } /* Rouge */

        /* Navigation */
        .nav { margin-bottom: 2rem; }
        .btn-back { text-decoration: none; color: #4b5563; font-weight: bold; display: flex; align-items: center; gap: 5px; }
        .btn-back:hover { color: #111827; }
    </style>
</head>
<body>

    <header>
        <div class="nav">
            <a href="index.html" class="btn-back">‚¨ÖÔ∏è Retour au Tableau de bord</a>
        </div>

        <h1>üîç Explorer la Biblioth√®que</h1>
        <p>Trouvez votre prochain livre et localisez-le dans nos rayons.</p>
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Rechercher par titre, auteur..." onkeyup="filterBooks()">
        </div>
    </header>

    <div class="grid" id="books-grid">
        </div>

    

    <script>
        const URL_LIVRES = 'http://localhost:8001/books';
        let allBooks = [];

        // 1. Charger les livres
        async function loadBooks() {
            try {
                const res = await fetch(URL_LIVRES);
                allBooks = await res.json();
                renderBooks(allBooks);
            } catch (err) {
                console.error("Erreur chargement", err);
                document.getElementById('books-grid').innerHTML = "<p style='text-align:center'>Impossible de charger le catalogue.</p>";
            }
        }

        // 2. Afficher (Render)
        function renderBooks(booksToDisplay) {
            const grid = document.getElementById('books-grid');
            
            if (booksToDisplay.length === 0) {
                grid.innerHTML = '<p style="text-align:center; grid-column: 1/-1;">Aucun livre trouv√© pour cette recherche.</p>';
                return;
            }

            grid.innerHTML = booksToDisplay.map(book => {
                const statusHtml = book.available 
                    ? `<span class="status available">‚óè Disponible</span>`
                    : `<span class="status unavailable">‚óè Emprunt√©</span>`;

                // Valeurs par d√©faut si la DB n'est pas encore remplie partout
                const location = book.location || "Rayon G√©n√©ral";
                const summary = book.summary || "Aucun r√©sum√© disponible pour ce livre.";

                return `
                <div class="card">
                    <div class="card-header">
                        <div class="card-title" title="${book.title}">${book.title}</div>
                        <div class="card-author">${book.author}</div>
                    </div>
                    <div class="card-body">
                        <div class="location-badge">üìç ${location}</div>
                        <p class="summary">${summary}</p>
                    </div>
                    <div class="card-footer">
                        ${statusHtml}
                        <small>Ref: ${book.id}</small>
                    </div>
                </div>
                `;
            }).join('');
        }

        // 3. Filtrer
        function filterBooks() {
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            
            const filtered = allBooks.filter(book => {
                const title = book.title.toLowerCase();
                const author = book.author.toLowerCase();
                return title.includes(searchText) || author.includes(searchText);
            });

            renderBooks(filtered);
        }

        loadBooks();
    </script>
</body>
</html>